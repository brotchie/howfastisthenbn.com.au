(function($){function MBToSize(x){return 1024>x?Math.floor(10*x)/10+" MB":(x/=1024,Math.floor(100*x)/100+" GB")}function SecondsToTimeRemaining(s,short){return s=Math.floor(s),60>=s?s+" seconds":short?Math.floor(s/60)+":"+(10>s%60?"0":"")+s%60:Math.floor(s/60)+"minutes "+s%60+" seconds"}$.downloads=function(root){var getAttr=function(name){return function(i,x){return $(x).attr(name)}},attrSelector=function(s){var selector="";return _.map(s,function(v,k){selector+="["+k+'="'+v+'"]'}),selector},roleSelector=function(c,role){return attrSelector({"data-download-case":c,"data-download-role":role})},cases=$.unique(root.find("[data-download-case]").map(getAttr("data-download-case")));cases.map(function(i,c){var button=$(root).find(roleSelector(c,"download")),triggered=!1;button.click(function(){return triggered||(triggered=!0,$(this).trigger("start.downloads"),$(this).addClass("disabled"),$(this).text($(this).attr("data-download-disabled-text")),ga("send","event","button","click",c)),!1});var progress=$(root).find(roleSelector(c,"progress"));progress.map(function(i,x){button.on("start.downloads",function(){var rate=$(x).attr("data-download-rate")/8,size=button.attr("data-download-size"),duration=size/rate;$(x).parent().addClass("active"),$(x).animate({width:"100%"},1e3*duration,"linear",function(){$(x).parent().removeClass("active")})})});var textProgress=$(root).find(roleSelector(c,"text-progress"));textProgress.map(function(i,x){button.on("start.downloads",function(){var rate=$(x).attr("data-download-rate")/8,size=button.attr("data-download-size"),duration=size/rate,startTime=Date.now(),updateProgress=function(){var elapsed=(Date.now()-startTime)/1e3,completed=elapsed/duration*size;if(duration>elapsed){var text=MBToSize(completed);text+=" of "+MBToSize(size),text+=", "+SecondsToTimeRemaining(duration-elapsed,!0)+" remaining",$(x).text(text)}else{var text=MBToSize(size)+" complete in "+SecondsToTimeRemaining(duration,!1);$(x).text(text),clearInterval(id)}},id=setInterval(updateProgress,1e3);updateProgress()})});var textComplete=$(root).find(roleSelector(c,"text-complete"));textComplete.map(function(i,x){button.on("start.downloads",function(){var rate=$(x).attr("data-download-rate")/8,size=button.attr("data-download-size"),duration=size/rate,startedText=$(x).attr("data-download-started-text"),completeText=$(x).attr("data-download-complete-text");$(x).text(startedText),setTimeout(function(){$(x).text(completeText)},1e3*duration)})});var dropboxProgress=$(root).find(roleSelector(c,"dropbox-progress"));dropboxProgress.map(function(i,x){button.on("start.downloads",function(){var rate=$(x).attr("data-download-rate")/8,size=button.attr("data-download-size"),duration=size/rate;$(x).find(".dropbox-idle-state").addClass("hidden"),$(x).find(".dropbox-sync1-state").removeClass("hidden");var startTime=Date.now();setInterval(function(){var elapsed=(Date.now()-startTime)/1e3;duration>elapsed?($(x).find(".dropbox-progress").removeClass("hidden"),$(x).find(".dropbox-progress div").text("Syncing (2 files, "+SecondsToTimeRemaining(duration-elapsed,!1)+" remaining)"),0==Math.round(elapsed)%2?($(x).find(".dropbox-sync1-state").removeClass("hidden"),$(x).find(".dropbox-sync2-state").addClass("hidden")):($(x).find(".dropbox-sync1-state").addClass("hidden"),$(x).find(".dropbox-sync2-state").removeClass("hidden"))):($(x).find(".dropbox-progress div").text("Up to Date."),$(x).find(".dropbox-sync1-state").addClass("hidden"),$(x).find(".dropbox-sync2-state").addClass("hidden"),$(x).find(".dropbox-ok-state").removeClass("hidden"),clearInterval(id))},1e3)})})})}})(jQuery);